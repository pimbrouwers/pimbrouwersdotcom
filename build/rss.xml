<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Pim Brouwers]]></title><description><![CDATA[The musings of a curious developer, fitness enthusiast and chair raver.]]></description><link>www.pimbrouwers.com</link><generator>Gulp 3.9.1</generator><lastBuildDate>Tue, 02 Aug 2016 12:04:50 GMT</lastBuildDate><atom:link href="www.pimbrouwers.com/rss.xml" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[How to Replace a Production SQL Table Without Downtime (Almost)]]></title><description><![CDATA[<p>There are instances when a production SQL table, or the data within it, needs to be modified in some way and significant downtime is not an option. I was recently confronted with this situation when a rogue script/code had injected millions (literally) of duplicate records into one of our production system tables.</p>
<p>My first thought was to write a simple &quot;DELETE FROM...&quot; query to expunge the duplicates, but given the sheer number of rows, the writes to the transaction log and of course the indexes/constraints on the table, this option would have an extensive execution time. Factoring in that downtime wasn&#39;t acceptable in this case, I had to come up with a solution that would essentially be &quot;instantaneous&quot;. Here&#39;s what I came up with:</p>
<p>To begin, we need to recreate the table.</p>
<pre><code class="lang-sql">CREATE TABLE [dbo].[tmp_YourTable](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [someCol1] [int] NOT NULL,
    [someCol2] [int] NOT NULL,
    [someCol3] [int] NOT NULL,    
 CONSTRAINT [tmp_YourTable_PK_v2] PRIMARY KEY CLUSTERED 
(
    [id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO

ALTER TABLE [dbo].[tmp_YourTable]  WITH CHECK ADD  CONSTRAINT [SomeOtherTable_tmp_YourTable_FK1_v2] FOREIGN KEY([someCol1])
REFERENCES [dbo].[SomeOtherTable]([someCol1])
GO

ALTER TABLE [dbo].[tmp_YourTable] CHECK CONSTRAINT [SomeOtherTable_tmp_YourTable_FK1_v2]
GO
</code></pre>
<p>Next, we need to write a query to get the unique records from our original table and insert them into our new table. It&#39;s critical to enable IDENTITY_INSERT to allow us to write values to the PK.</p>
<pre><code class="lang-sql">SET IDENTITY_INSERT tmp_YourTable ON

INSERT INTO tmp_YourTable (id, someCol1, someCol2, someCol3)
select max(id) as id, pageItemID, someCol1, someCol2, someCol3
from YourTable with (nolock)
GROUP BY id, someCol1, someCol2, someCol3

SET IDENTITY_INSERT tmp_YourTable OFF
GO
</code></pre>
<p>Finally, we do the always scary table rename.</p>
<pre><code class="lang-sql">BEGIN TRANSACTION;  
    DROP TABLE [dbo].[YourTable]
    GO

    EXEC sp_rename &#39;tmp_YourTable&#39;, &#39;YourTable&#39;;
COMMIT TRANSACTION;
</code></pre>
<p>And there you have it, we swapped a production table with little to no down time whatsoever.</p>
]]></description><link>www.pimbrouwers.com/replace-production-sql-table-without-downtime/</link><guid isPermaLink="false">www.pimbrouwers.com/replace-production-sql-table-without-downtime/</guid><category><![CDATA[SQL]]></category><pubDate>Fri, 11 Mar 2016 05:00:00 GMT</pubDate></item><item><title><![CDATA[Why Minor Units are a Smart Choice for E-commerce Solutions]]></title><description><![CDATA[<p>E-commerce websites are among the most common types of web applications around on the internet today. It is estimated that in 2016, e-commerce sites as a collective, will account for $1.155 trillion USD in global revenue. A growth of nearly 50% since 2013.</p>
<p>There are many technologies available to get an e-commerce site up and running quickly. Services like Shopify and Magento for example. These services are fantasic, so long as you implementation is very straight forward. But there are instances where trying to implement them will feel like putting a square peg in a round hole. Presenting a perfect opportunity to develop a bespoke e-commerce platform. This approach is indeed more flexible, but isn&#39;t without it&#39;s concerns.</p>
<p>One of the more common challengers faced when developing a custom e-commerce implementation is deciding how to store monetary values. You might ask yourself &quot;wouldn&#39;t you just store the values as they&#39;re represented in real life? (ie: $99.99)&quot;. The short answer to that question is, no. And the reason for this is the fundamental flaw of floating point arithmetic.</p>
<p>The problem stems from the fact that floats and doubles cannot accurately represent the base 10 multiples that we use for money. This isn&#39;t an explicitly technical article, so we won&#39;t get caught up too much in why this happens just that it does. Beyond rounding errors, arithmetic done using integers requires far fewer processing cycles which equates to faster calculations.</p>
<p>Now that we&#39;ve decided to store our currency in minor units, it&#39;s time to pick a rounding strategy. It&#39;s inevitable that when you&#39;re performing calculations on dollar values, even in minor units, that you will need to round at some point. The question you need to ask yourself is, do you want to keep the extra for yourself or be a nice guy and let the customer keep it? Whichever direction you choose, it&#39;s important to stick with it throughout your application. From a coding point of view I prefer to round down as preference because the floor method in most languages tends to be much more reliable that a ceiling method.</p>
<p>So there you have it. In no way is this article designed to be doctrine for creating a trouble-free finance system for your e-commerce store, but will hopefully help guide you to developing a solid starting point and hopefully avoid a few hours of head-scratching.</p>
]]></description><link>www.pimbrouwers.com/e-commerce-minor-units/</link><guid isPermaLink="false">www.pimbrouwers.com/e-commerce-minor-units/</guid><category><![CDATA[E-commerce]]></category><pubDate>Thu, 10 Mar 2016 05:00:00 GMT</pubDate></item><item><title><![CDATA[Selection Partial Input Text on Focus, Click and Other DOM Events]]></title><description><![CDATA[<p>I was recently working on a project that enabled users to rename files, backed by blob storage assets. Where this type of functionality becomes problematic is when files are renamed without extensions. We of course do not want to limit the user in anyway so we must expose the ability to modify the file name in it&#39;s entirety. In addition to checking server-side, which is always advisable in situations like this, I wanted to create an OS-like experience by default selecting the file name only without the extension. Windows 7/8 and OS X do this very nicely, and it makes renaming files more intuitive. How often are we modifying extensions right?</p>
<p>To implement this from a code stand point is super simple. Consider the following:</p>
<ul>
<li>Define a functions that locates the final period of the input value (assuming there is a value)</li>
<li>On DOM ready, bind the &quot;focus&quot; and &quot;click&quot; event handlers to this function </li>
</ul>
<p>Now in code:</p>
<pre><code class="lang-Javascript">//establish text selection method
var selectFilename = function () {
    var textval = $(this).val();

    if (!textval || textval == null || textval == &quot;&quot;) return;

    //find last period
    var suffixStartpos = textval.lastIndexOf(&quot;.&quot;);

    if (!suffixStartpos || suffixStartpos == null || suffixStartpos == &quot;&quot;) return;

    //set selection if all requirements fulfilled
    this.setSelectionRange(0, suffixStartpos);
};

//bind
$(&quot;#textinput&quot;).on(&quot;focus click&quot;, selectFilename);
</code></pre>
]]></description><link>www.pimbrouwers.com/selecting-partial-input-text-on-focus-and-click/</link><guid isPermaLink="false">www.pimbrouwers.com/selecting-partial-input-text-on-focus-and-click/</guid><category><![CDATA[JavaScript]]></category><category><![CDATA[UX]]></category><pubDate>Thu, 07 Jan 2016 05:00:00 GMT</pubDate></item><item><title><![CDATA[Determining Prime Numbers using RegEx]]></title><description><![CDATA[<p>This post is about programmatically determining if a number is prime. To begin, what is a prime number? A prime number is a number that is only evenly-divisible (ie: producing a natural number) by itself and 1. In sequence, the first natural prime, is 2.</p>
<p>From a programmatic stand point there are many ways to solve this problem. Most notably using iteration. For example, let&#39;s considering the number 7. Using iteration, we could loop through all the numbers between 1 and 7 and test whether the product is natural. I&#39;ve used this method myself and it works quite well. I came across this solution today, which uses regular expressions and it&#39;s amazing to say the least (the following implementation is using PHP):</p>
<pre><code class="lang-php">function isPrime($number) {
    return !preg_match(&#39;/^1?$|^(11+?)\1+$/x&#39;, str_repeat(&#39;1&#39;, $number));
}
</code></pre>
<p>The regular expression tests a sequence of 1&#39;s, equally the count of the number passed into the method. Let&#39;s breakdown the regular expression step by step:</p>
<pre><code>/
  ^1?$   # matches beginning, optional 1, ending.
         # thus matches the empty string and &quot;1&quot;.
         # this matches the cases where N was 0 and 1
         # and since it matches, will not flag those as prime.
|   # or...
  ^                # match beginning of string
    (              # begin first stored group
     1             # match a one
      1+?          # then match one or more ones, minimally.
    )              # end storing first group
    \1+            # match the first group, repeated one or more times.
  $                # match end of string.
/x
</code></pre><p>So, you can see how this process is analogous to trying to divide a number by successively larger divisors, leaving no remainder. In the case of a prime number, this is never going to succeed.</p>
]]></description><link>www.pimbrouwers.com/determining-prime-numbers-using-regex/</link><guid isPermaLink="false">www.pimbrouwers.com/determining-prime-numbers-using-regex/</guid><category><![CDATA[RegEx]]></category><pubDate>Tue, 24 Nov 2015 05:00:00 GMT</pubDate></item><item><title><![CDATA[Solving Top-n Per Group in SQL]]></title><description><![CDATA[<p>A common problem you run into with normalized DBs is top-n-per-group situation. A good example is:</p>
<p>Suppose you have a table of customers and a table of purchases. Each purchase belongs to one customer and you want to get a list of all customers along with their last purchase.</p>
<p>I used to solve this problem with a subquery as a derived table for the inner join, looking for the max ID. However, I came across this solution today, and itâ€™s AWESOMELY simple. Take a look:</p>
<pre><code class="lang-sql">select *
from customers c
inner join purchases p1
    on p1.CustomerID = c.ID
left join purchases p2
    on p2.CustomerID = c.ID
    and       
    (
        p1.ID &lt; p2.ID
    )
where c.ID = 1 and p2.ID is null
</code></pre>
]]></description><link>www.pimbrouwers.com/top-n-per-group-sql/</link><guid isPermaLink="false">www.pimbrouwers.com/top-n-per-group-sql/</guid><category><![CDATA[SQL]]></category><pubDate>Sat, 18 Apr 2015 04:00:00 GMT</pubDate></item><item><title><![CDATA[SQL - How to copy just the structure from an existing table]]></title><description><![CDATA[<p>You might find yourself in a situation where you want to clone an SQL table, but leave the existing data behind.</p>
<p>Here&#39;s how you would copy just the structure of an existing SQL table:</p>
<pre><code class="lang-sql">CREATE TABLE new_table
AS (SELECT * FROM old_table WHERE 1=2);
</code></pre>
<p>This would create a new table called &quot;new_table&quot; that includes all columns from the &quot;old_table&quot; table, but no data from the &quot;new_table&quot; table.</p>
]]></description><link>www.pimbrouwers.com/sql-copy-just-table-structure-from-existing-table/</link><guid isPermaLink="false">www.pimbrouwers.com/sql-copy-just-table-structure-from-existing-table/</guid><category><![CDATA[SQL]]></category><pubDate>Fri, 13 Mar 2015 04:00:00 GMT</pubDate></item><item><title><![CDATA[CakePHP - Adding Style to CakePHP Input Div by Extending FormHelper]]></title><description><![CDATA[<p>Anyone arriving here looking for a way to add a class to input div wrappers application-wide (ex: if you&#39;re using a front-end framework which often requires a specific class name be added to input wrappers to enable auto-styles) there is a MUCH better solution. That being, a custom FormHelper.</p>
<ul>
<li>In the App/View/Helper directory create and save a file &quot;MySuperCoolFormHelper.php&quot;</li>
<li>Place the following code in the file</li>
</ul>
<pre><code class="lang-php">App::uses(&#39;FormHelper&#39;, &#39;View/Helper&#39;);

class MySuperCoolFormHelper extends FormHelper {

    protected function _divOptions($options) {
        if(isset($options[&#39;div&#39;])
            $options[&#39;div&#39;] .= &#39; class1 class2 class3&#39;; //note the prefixing space
        else
            $options[&#39;div&#39;] = &#39;class1 class2 class3&#39;;

        return parent::_divOptions($options);
    }
}
</code></pre>
<p>... and BLAMMO you&#39;re done!</p>
]]></description><link>www.pimbrouwers.com/adding-style-to-cake-input-div-by-extending-formhelper/</link><guid isPermaLink="false">www.pimbrouwers.com/adding-style-to-cake-input-div-by-extending-formhelper/</guid><category><![CDATA[CakePHP]]></category><pubDate>Fri, 07 Nov 2014 05:00:00 GMT</pubDate></item><item><title><![CDATA[CakePHP - How to Access an Associated Model in beforeSave Function]]></title><description><![CDATA[<p>In CakePHP, as with any other MVC framework, we often need access to the models directly associated to the one currently being acted upon. In Cake &gt; 2.x this is a simple procedure. I&#39;ll explain using an example.</p>
<ul>
<li>We have a model Subscription which belongsTo a SubscriptionsPlan</li>
<li><p>Model SubscriptionsPlan hasMany Suscriptions
To access the SubscriptionsPlan data in a beforeSave function in the Subscription model, you would do the following:</p>
<pre><code class="lang-php">public function beforeSave($options = array()){
  $options = array(
      &#39;conditions&#39; =&gt; array(
          &#39;SubscriptionsPlan.subscriptions_plan_id&#39; =&gt; $this-&gt;data[$this-&gt;alias][&#39;subscriptions_plan_id&#39;]
      )
  );

  $plan = $this-&gt;SubscriptionsPlan-&gt;find(&#39;first&#39;, $options);

  //REST OF BEFORE SAVE CODE GOES HERE
  return true;
}
</code></pre>
</li>
</ul>
]]></description><link>www.pimbrouwers.com/cakephp-access-associated-model-in-beforesave/</link><guid isPermaLink="false">www.pimbrouwers.com/cakephp-access-associated-model-in-beforesave/</guid><category><![CDATA[CakePHP]]></category><pubDate>Sat, 27 Sep 2014 04:00:00 GMT</pubDate></item><item><title><![CDATA[WAMP Server Won't Start]]></title><description><![CDATA[<p>WAMP Server is development platform for Windows (Windows Apache MySQL PHP). On occasion, when deploying a new copy of WAMP Server you may find that after enabling virtual hosts or modifying the configuration files, WAMP will no longer start. This is typically due to syntax errors in the aforementioned files.</p>
<ul>
<li>Go to start menu -&gt;</li>
<li>Type &quot;cmd&quot; -&gt;</li>
<li>Press enter -&gt;</li>
<li>Paste the following &quot;C:\wamp\bin\apache\apache2.2.22\bin\httpd.exe&quot; (note: your Apache version may be different)</li>
</ul>
<p>This will indicate to you the exact line on which the error is occurring.</p>
]]></description><link>www.pimbrouwers.com/wamp-server-wont-start/</link><guid isPermaLink="false">www.pimbrouwers.com/wamp-server-wont-start/</guid><category><![CDATA[WAMP]]></category><pubDate>Sat, 27 Sep 2014 04:00:00 GMT</pubDate></item></channel></rss>